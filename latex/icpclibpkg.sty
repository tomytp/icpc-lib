% ICPC Library Package - KACTL-style compact formatting
% Adapted from KACTL's kactlpkg.sty for icpc-lib
%
% Usage: \usepackage{icpclibpkg} in a 9pt extarticle document
%
\ProvidesPackage{icpclibpkg}

% ============================================================
% Core packages
% ============================================================
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{tgtermes}  % Times-like font (compact)
\usepackage[scaled=0.85]{beramono}  % Monospace font
\usepackage{amsmath,amssymb}
\usepackage{microtype}

% Layout
\usepackage[landscape, left=5mm, right=5mm, top=7mm, bottom=7mm]{geometry}
\usepackage{multicol}
\usepackage{fancyhdr}
\usepackage{titlesec}

% Code listings
\usepackage{listings}
\usepackage{xcolor}

% Links and PDF metadata
\usepackage[pdfusetitle,hidelinks]{hyperref}

% ============================================================
% Color definitions
% ============================================================
\definecolor{keyword}{HTML}{0000FF}
\definecolor{comment}{HTML}{228B22}
\definecolor{string}{HTML}{A31515}
\definecolor{type}{HTML}{0077AA}
\definecolor{hashcolor}{HTML}{808080}
\definecolor{chaptercolor}{HTML}{000080}

% ============================================================
% Listings configuration for C++
% ============================================================
\lstdefinestyle{icpclib}{
    language=C++,
    basicstyle=\ttfamily\fontsize{7.5pt}{8.5pt}\selectfont,
    keywordstyle=\color{keyword}\bfseries,
    commentstyle=\color{comment}\itshape,
    stringstyle=\color{string},
    showstringspaces=false,
    breaklines=true,
    breakatwhitespace=false,
    breakindent=0pt,
    postbreak={},
    tabsize=4,
    columns=fullflexible,
    keepspaces=true,
    xleftmargin=0pt,
    xrightmargin=0pt,
    aboveskip=2pt,
    belowskip=2pt,
    frame=none,
    % Custom type highlighting
    morekeywords=[2]{ll,ull,ld,i64,u64,p64,pii,pll,v64,vll,vi,vii,vvi},
    keywordstyle=[2]\color{type}\bfseries,
    % Escape for hash prefix
    escapeinside={@}{@},
    literate=
        {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
        {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
        {ã}{{\~a}}1 {õ}{{\~o}}1 {ñ}{{\~n}}1
        {Ã}{{\~A}}1 {Õ}{{\~O}}1 {Ñ}{{\~N}}1
        {ç}{{\c{c}}}1 {Ç}{{\c{C}}}1
}
\lstset{style=icpclib}

% ============================================================
% Layout configuration
% ============================================================
\setlength{\columnseprule}{0.4pt}
\setlength{\columnsep}{4mm}
\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt}

% Reduce spacing around section/subsection headers
\titlespacing*{\section}{0pt}{2ex plus 1ex minus 0.5ex}{1ex plus 0.3ex}
\titlespacing*{\subsection}{0pt}{1.5ex plus 0.5ex minus 0.3ex}{0.5ex plus 0.2ex}
\titleformat{\section}{\normalfont\large\bfseries\color{chaptercolor}}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries}{\thesubsection}{0.5em}{}

% ============================================================
% Header/Footer - shows current section on each page
% ============================================================
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Track current chapter and section
\newcommand{\@currentchapter}{}
\newcommand{\setchapter}[1]{\renewcommand{\@currentchapter}{#1}}

\fancyhead[L]{\small\textbf{Biblioteca PUC-Rio}}
\fancyhead[C]{\small\@currentchapter}
\fancyhead[R]{\small\thepage}

\fancyfoot[C]{\small\thepage}

% Apply fancy style to all pages including first page
\fancypagestyle{plain}{\pagestyle{fancy}}

% Reduce header height
\setlength{\headheight}{12pt}
\setlength{\headsep}{3mm}

% ============================================================
% Custom commands for importing code
% ============================================================

% Hash prefix command (for line-by-line integrity hashes)
\newcommand{\hashprefix}[1]{\textcolor{hashcolor}{\ttfamily #1}}

% Custom type highlighting command
\newcommand{\typ}[1]{\textcolor{type}{\textbf{#1}}}

% Import a code file
% Usage: \icpclibimport{path/to/file.cpp}
% or: \icpclibimport[-c "Custom Title"]{path/to/file.cpp}
\newcommand{\icpclibimport}[2][]{%
    \immediate\write18{python3 preprocessor.py "#2" "#1"}%
    \input{|"python3 preprocessor.py \\"#2\\" \\"#1\\""}%
}

% Alternative: direct input of pre-generated .tex
\newcommand{\icpclibinput}[1]{\input{#1}}

% Chapter command - sets header and includes chapter file
% Usage: \icpclibchapter{structures}
\newcommand{\icpclibchapter}[1]{%
    \setchapter{#1}%
    \input{chapters/#1.tex}%
}

% Section for code entry with metadata
% Usage: \codeentry{Title}{Hash}{Time}{Memory}
\newcommand{\codeentry}[4]{%
    \subsection[#1]{#1 \hfill {\small\texttt{#2}} {\footnotesize #3 #4}}%
}

% Simpler code entry without complexity info
\newcommand{\codesection}[2]{%
    \subsection[#1]{#1 \hfill {\small\textcolor{hashcolor}{\texttt{#2}}}}%
}

% Code entry with just title
\newcommand{\codetitle}[1]{%
    \subsection{#1}%
}

% Description text (italic, compact)
\newcommand{\codedesc}[1]{%
    {\small\textit{#1}\par\vspace{1pt}}%
}

% Complexity line
\newcommand{\complexity}[1]{%
    {\small\textbf{Complexity:} #1\par\vspace{1pt}}%
}

% ============================================================
% Table of contents styling
% ============================================================
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{1pt}
\setlength{\cftbeforesubsecskip}{0pt}
\renewcommand{\cftsecfont}{\small\bfseries}
\renewcommand{\cftsubsecfont}{\small}
\renewcommand{\cftsecpagefont}{\small}
\renewcommand{\cftsubsecpagefont}{\small}
\setlength{\cftsecnumwidth}{2em}
\setlength{\cftsubsecnumwidth}{2.5em}
\setlength{\cftsubsecindent}{2em}

% Compact TOC
\newcommand{\compacttoc}{%
    \begin{multicols}{3}
    \footnotesize
    \tableofcontents
    \end{multicols}
}

\endinput
